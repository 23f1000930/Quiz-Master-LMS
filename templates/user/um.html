{% extends 'base/user_base.html' %}
{% block page_title %} Home {% endblock %}

{% block user_css %}
<style>
  /* Sidebar Default (Closed) */
.sidebar {
    height: 45vh;
}


/* Calculator container styling */
#calculatorContainer {
          display: none;
          position: absolute;
          width: 420px;
          height: 311px;
          background: white;
          border: 2px solid black;
          border-radius: 8px;
          box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
      }

      /* Header for dragging */
      #calculatorHeader {
          cursor: move;
          background: #333;
          color: white;
          padding: 10px;
          text-align: center;
          border-top-left-radius: 8px;
          border-top-right-radius: 8px;
      }

      /* Close button */
      #closeBtn {
          position: absolute;
          top: 5px;
          right: 10px;
          background: red;
          color: white;
          border: none;
          padding: 5px 10px;
          cursor: pointer;
          font-size: 14px;
          border-radius: 4px;
      }

      /* Iframe styling */
      iframe {
          width: 100%;
          height: 264px;
          border-radius: 6px;
      }

      .accordion-body{
        padding: 0px;
      }

      .question{
          margin-block: -28px;
      }
</style>
{% endblock %}

{% set NOtShowSubjectSummary = True %}

{% block ShowModuleScoreCalculator %}
<a href="user_module.html" id="umod">
  <i class="bi bi-journal-text"></i>
  <span>Modules</span>
</a>
<a href="user_score.html" id="uscore">
  <i class="bi bi-plus-slash-minus"></i>
  <span>Scores</span>
</a>
<a onclick="toggleCalculator()" id="calculator-btn">
  <i class="bi bi-calculator"></i>
  <span>Calculator</span>
</a>
{% endblock %}






{% block user_content %}

<div class="d-flex">
  

  <!-----------------------------------------------Chapter/Module Accordion STARTS------------------------------->
  <div class="accordion border border-dark rounded-3" id="accordionPanelsStayOpenExample z-n1 position absolute" style="width: 320px; margin-top: 14px; margin-left: 70px; height: 90vh; overflow: auto; padding-right: 0px;">
      <div>
        <span class="badge text-bg-dark" style="display: inline-block; width: 320px; height: auto; font-size: 19px; padding: 11px; word-wrap: break-word; white-space: normal; text-align: center;">
        {{ subject.name }}
        </span>

        {% for chapter in chapters %}
        <div class="accordion-item">

            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{chapter.id}}" aria-expanded="false" aria-controls="collapse{{chapter.id}}">
                <h6>{{ loop.index }}. {{ chapter.name }}</h6>
                </button>
            </h2>
            <div id="collapse{{chapter.id}}" class="accordion-collapse collapse">
                <div class="accordion-body">
                <div class="row">
                    <div class="list-group" id="list-tab" role="tablist">
                        {% for lecture in chapter.lectures %}
                            <a class="list-group-item list-group-item-action" id="list-home-list" data-bs-toggle="list" href="#list-home" role="tab" aria-controls="list-home">{{ loop.index }}. {{ lecture.name }}</a>
                            
                            {% for quiz in lecture.quizzes %}
                                <a class="list-group-item list-group-item-action" id="list-home-list" data-bs-toggle="list" href="#list-home" role="tab" aria-controls="list-home"><strong> {{ loop.index }} Quiz {{ quiz.release_date }}</strong> </a>
                            {% endfor %}

                        {% endfor %}

                       {% for quiz in chapter.quizzes %}
                            {% if not quiz.lecture_id %}
                                <a class="list-group-item list-group-item-action" id="list-home-list" data-bs-toggle="list" href="#list-home" role="tab" aria-controls="list-home"><strong> {{ loop.index }} Quiz {{ quiz.release_date }}</strong> </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                </div>
            </div>
            
        </div>
        {% endfor %}


      </div>
  </div>
  <!-----------------------------------------------Module Accordion ENDS------------------------------->
  
  
  
  <div class="bg-body rounded-3 ms-auto border border-dark px-3" style="margin-top: 14px; width: 1285px; margin-right: 15px; height: 90vh; overflow: auto;">
  <!------------------------------------------------------Quiz Content STARTS------------------------------------->    
  <!-- <iframe src="testcontent.html" width="50%" height="60%"></iframe> -->
  {% include "testcontent.html" %}

      
  </div>



</div>



<!-- Draggable Calculator -->
<div id="calculatorContainer">
  <div id="calculatorHeader">
      Calculator (Dragable)
      <button id="closeBtn" onclick="toggleCalculator()">X</button>
  </div>
  <iframe src="https://www.desmos.com/scientific"></iframe>
</div>

<!-- Draggable Calculator -->
<script>
  function toggleCalculator() {
      let calcDiv = document.getElementById("calculatorContainer");
      let calcBtn = document.getElementById("calculator-btn");
      if (calcDiv.style.display === "none") {
          calcDiv.style.display = "block"; // Show

          // Highlight calculator button
          calcBtn.style.background = "black";
          calcBtn.style.color = "white";
          calcDiv.style.top = "100px";  // Default position
          calcDiv.style.right = "100px"; 
      } else {
          calcDiv.style.display = "none";  // Hide
          // Highlight calculator button
          calcBtn.style.background = "#f8f9fa";
          calcBtn.style.color = "black";
      }
  }

  // Drag Functionality
  let dragItem = document.getElementById("calculatorContainer");
  let header = document.getElementById("calculatorHeader");

  let offsetX = 0, offsetY = 0, isDragging = false;

  header.addEventListener("mousedown", (e) => {
      isDragging = true;
      offsetX = e.clientX - dragItem.offsetLeft;
      offsetY = e.clientY - dragItem.offsetTop;
  });

  document.addEventListener("mousemove", (e) => {
      if (isDragging) {
          dragItem.style.left = (e.clientX - offsetX) + "px";
          dragItem.style.top = (e.clientY - offsetY) + "px";
      }
  });

  document.addEventListener("mouseup", () => {
      isDragging = false;
  });
</script>

{% endblock %}